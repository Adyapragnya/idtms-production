import{r,j as e,o as $,v as B}from"./index-CLNSMZLW.js";import{a as m}from"./axios-CCb-kr4I.js";import{S as w}from"./sweetalert2.all-CmvVThYx.js";import{F as U,f as k}from"./index-CjlhgdOE.js";/* empty css                   */import{B as x,A,M as v,a as E,b as R,c as O}from"./Modal-Dv45EkXD.js";import{s as j}from"./sweetalert.min-DiFPS6I4.js";import{C as I,a as M}from"./CCardBody-CfTsVxOj.js";import{C as L}from"./CCardHeader-DTDcNGzu.js";import{C as T}from"./CForm-C4b5e9R_.js";import{C}from"./CFormInput-tclTmhjH.js";import{C as P}from"./CFormSelect-Bci_q2OS.js";import{C as z}from"./CCol-B1-P30fP.js";import{a as H}from"./index.esm-DtmDK9am.js";import"./index-DAjb0mx0.js";import"./CFormControlWrapper-xxYQpUFA.js";import"./CFormControlValidation-CHapmSMf.js";import"./CFormLabel-DPrUA8EZ.js";const G=({title:F,documentId:n,onFilesChange:N})=>{const[g,f]=r.useState(!1),[p,o]=r.useState(""),[u,y]=r.useState([]),[b,c]=r.useState(null),S=a=>{const t=a.target.files[0],i=["image/jpeg","image/png","application/pdf"],s=5*1024*1024;t&&(i.includes(t.type)?t.size>s?j("File too large","Please upload a file smaller than 5 MB","error"):(c(t),o(t.name)):j("Invalid file type","Please upload a valid file (JPEG, PNG, PDF)","error"))},D=async()=>{const a=new FormData;a.append("file",b),a.append("formattedFileName",p);try{const t="http://localhost:5000",i=await m.post(`${t}/api/upload-file`,a,{headers:{"Content-Type":"multipart/form-data"}}),s=i.data.filePath;await m.post(`${t}/api/document/${n}/file-path`,{filePath:s}),await m.post(`${t}/api/tracker/${n}/file-path`,{filePath:s});const h=[...u,{formattedFileName:i.data.fileName,file:b,filePath:s}];y(h),N(h),f(!1),c(null),o("")}catch(t){console.error("Error uploading file:",t)}},d=a=>{a.filePath?window.open(`http://localhost:5000/uploads/${a.filePath}`,"_blank"):console.error("File path is undefined.")},l=a=>{j({title:"Are you sure?",text:"Once deleted, you will not be able to recover this file!",icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{if(t){const i=u.filter(s=>s.formattedFileName!==a);y(i),N(i),j("Your file has been deleted!",{icon:"success"})}else j("Your file is safe!")})};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h5",{className:"mb-0",children:F}),e.jsxs(x,{onClick:()=>f(!0),variant:"outline-primary",children:[e.jsx(A,{size:24,className:"me-2"})," Upload File"]})]}),e.jsxs(v,{show:g,onHide:()=>f(!1),centered:!0,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Upload File"})}),e.jsx(v.Body,{children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("input",{type:"text",className:"form-control mb-3",placeholder:"Enter File Name",value:p,onChange:a=>o(a.target.value)}),e.jsx("input",{type:"file",id:"file-upload",className:"d-none",onChange:S}),e.jsxs(x,{onClick:()=>document.getElementById("file-upload").click(),variant:"primary",className:"mb-3",children:[e.jsx(E,{className:"me-2"})," Choose File"]}),e.jsx(x,{onClick:D,variant:"success",children:"Upload"})]})})]}),e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"File Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:u.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.formattedFileName}),e.jsxs("td",{children:[e.jsxs(x,{variant:"outline-success",className:"me-2",onClick:()=>d(a),children:[e.jsx(R,{})," View"]}),e.jsxs(x,{variant:"outline-danger",onClick:()=>l(a.formattedFileName),children:[e.jsx(O,{})," Delete"]})]})]},t))})]})]})},re=()=>{const F=$(),{documentId:n}=B(),[N,g]=r.useState(null),[f,p]=r.useState([]),[o,u]=r.useState({date:new Date().toISOString().split("T")[0],authority:"",title:"",description:"",status:""}),[y,b]=r.useState(!0);r.useState({}),r.useEffect(()=>{(async()=>{var l;try{const a="http://localhost:5000",t=await m.get(`${a}/api/get-document/${n}`);g(t.data),u({...o,authority:t.data.authority||"",title:t.data.documentName||"",description:t.data.trackDescription||"",status:t.data.Status||""});const s=(await m.get(`${a}/api/get-files/${n}`)).data.filter(h=>h.filePath);p(s)}catch(a){console.error("Error fetching document or files:",((l=a.response)==null?void 0:l.data)||a.message)}finally{b(!1)}})()},[n]);const c=d=>{const{name:l,value:a}=d.target;u(t=>({...t,[l]:a}))},S=async d=>{var l;try{p(s=>[...s,...d]);const i=(await m.get(`http://localhost:5000/api/get-files/${n}`)).data.filter(s=>s.filePath);p(i)}catch(a){console.error("Error updating files:",((l=a.response)==null?void 0:l.data)||a.message)}},D=async d=>{var l,a;d.preventDefault();try{const t="http://localhost:5000",i={dateOfUpdate:o.date,trackDescription:o.description,Status:o.status,authority:o.authority,filePaths:f.map(h=>h.filePath)};console.log(i),await m.put(`${t}/api/update-document/${n}`,i);const s=await m.get(`${t}/api/get-document/${n}`);g(s.data),u({...o,authority:s.data.authority||"",title:s.data.documentName||"",description:s.data.trackDescription||"",status:s.data.Status||""}),w.fire({title:"Success!",text:"Status updated successfully!",icon:"success",confirmButtonText:"OK"}),F("/trackdocuments")}catch(t){console.error("Error details:",t.response?t.response.data:t.message),w.fire({title:"Error!",text:((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||"Error updating document. Please try again.",icon:"error",confirmButtonText:"OK"})}};return y?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:"m-lg-4 m-xl-4",children:e.jsxs(I,{children:[e.jsx(L,{className:"text-center text-info",children:e.jsx("h4",{children:"Update Document"})}),e.jsx(M,{className:"m-lg-4 m-xl-4",children:e.jsxs(T,{onSubmit:D,children:[e.jsx(C,{type:"text",name:"documentId",value:n,label:"Document ID",disabled:!0,className:"mb-3"}),e.jsx(C,{type:"date",name:"date",value:o.date,onChange:c,label:"Date",className:"mb-3"}),e.jsxs(P,{name:"authority",value:o.authority,onChange:c,label:"Authority",className:"mb-3",children:[e.jsx("option",{value:"",children:"Select Authority"}),e.jsx("option",{value:"bbmp",children:"BBMP"}),e.jsx("option",{value:"bda",children:"BDA"}),e.jsx("option",{value:"bmrda",children:"BMRDA"}),e.jsx("option",{value:"pcb",children:"PCB"})]}),e.jsx(C,{type:"text",name:"title",value:o.title,onChange:c,label:"Title",className:"mb-3"}),e.jsx(C,{type:"text",name:"description",value:o.description,onChange:c,label:"Description",className:"mb-3"}),e.jsxs(P,{name:"status",value:o.status,onChange:c,label:"Status",className:"mb-3",children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"clarified",children:"Clarification"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"sanctioned",children:"Sanctioned"}),e.jsx("option",{value:"submitted",children:"Submitted"})]}),e.jsx(G,{title:"Status Files",documentId:n,status:o.status,onFilesChange:S}),e.jsx(z,{xs:12,className:"d-flex justify-content-center",children:e.jsxs(H,{type:"submit",color:"primary",className:"mt-3",children:[e.jsx(U,{icon:k})," update"]})})]})})]})})};export{re as default};
